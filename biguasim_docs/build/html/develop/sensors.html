<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developing Sensors &mdash; BiguaSim 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom_style.css?v=88f29eac" />

  
    <link rel="shortcut icon" href="../_static/favicon.svg"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=8d563738"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/darkmode.js?v=3994c1fa"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Developing Agents" href="agents.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BiguaSim
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">BiguaSim Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/usage.html">Using BiguaSim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packages/packages.html">BiguaSim Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/agents.html">BiguaSim Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensors/sensors.html">BiguaSim Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="develop.html">Developing BiguaSim</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="env.html">Developing Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Developing Agents</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Developing Sensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#c">C++</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#h-file">.h file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpp-file">.cpp file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#allowing-your-sensor-to-be-used-in-biguasim">Allowing Your Sensor to Be Used In BiguaSim</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/index.html">BiguaSim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/spaces.html">Action Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/biguasimclient.html">BiguaSim Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/packagemanager.html">Package Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/lcm.html">LCM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/dynamics.html">BiguaSim Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/shmem.html">Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/util.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../biguasim/weather.html">Weather Controller</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BiguaSim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="develop.html">Developing BiguaSim</a></li>
      <li class="breadcrumb-item active">Developing Sensors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/develop/sensors.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developing-sensors">
<span id="develop-sensor"></span><h1>Developing Sensors<a class="headerlink" href="#developing-sensors" title="Link to this heading"></a></h1>
<p>Similar to agents, sensors are built on both the C++ and Python sides. In this section we will give
an example of developing a sensor and explain how to set it up in both C++ and Python.</p>
<p>The example sensor we will be using is a simple sensor that returns the float <code class="docutils literal notranslate"><span class="pre">2.0</span></code> at each tick.
This is a very simple sensor, but it will give you the basic structure of how to set up a sensor.</p>
<section id="c">
<h2>C++<a class="headerlink" href="#c" title="Link to this heading"></a></h2>
<p>Each sensor will need a ‘.h’ and ‘.cpp’ file, as is standard practice for C++.</p>
<p>These will both be placed in <code class="docutils literal notranslate"><span class="pre">engine/Source/Holodeck/Sensors</span></code>, with the <code class="docutils literal notranslate"><span class="pre">.h</span></code> in Public and the
<code class="docutils literal notranslate"><span class="pre">.cpp</span></code> in Private.</p>
<section id="h-file">
<h3>.h file<a class="headerlink" href="#h-file" title="Link to this heading"></a></h3>
<p>Start by including the following in your <code class="docutils literal notranslate"><span class="pre">.h</span></code> file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Holodeck.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HolodeckSensor.h&quot;</span>
</pre></div>
</div>
<p>Next, set up the class for the sensor:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ExampleSensor.generated.h&quot;</span>

<span class="n">UCLASS</span><span class="p">(</span><span class="n">ClassGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Custom</span><span class="p">),</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintSpawnableComponent</span><span class="p">))</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HOLODECK_API</span><span class="w"> </span><span class="n">UExampleSensor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UHolodeckSensor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="k">protected</span><span class="o">:</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The name of the sensor needs to have the character “U” before it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;ExampleSensor.generated.h&quot;</span></code> is necessary for Unreal Engine to generate the proper
code for the sensor. This is a requirement for all classes that are derived from UObjects.</p></li>
</ul>
</div>
<p>Now let’s go over a few of the main necessary functions to put into the .h file. First, make sure
your sensor has a constructor and an InitializeSensor() override like this one (note that these
should be under the <code class="docutils literal notranslate"><span class="pre">public</span></code> section of the class):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">UExampleSensor</span><span class="p">();</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">InitializeSensor</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, in the <code class="docutils literal notranslate"><span class="pre">protected</span></code> section, you will need a tick function. This function defines the behavior
of the sensor every time the simulation ticks.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">TickSensorComponent</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">,</span><span class="w"> </span><span class="n">ELevelTick</span><span class="w"> </span><span class="n">TickType</span><span class="p">,</span><span class="w"> </span><span class="n">FActorComponentTickFunction</span><span class="o">*</span><span class="w"> </span><span class="n">ThisTickFunction</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
</pre></div>
</div>
<p>Finally, the last item that is essential for a sensor is the pointer to the parent agent in the
<code class="docutils literal notranslate"><span class="pre">private</span></code> section. This simply stores a reference to whatever object the sensor is attached to:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Parent</span><span class="p">;</span>
</pre></div>
</div>
<p>You may also want to include some helper functions and some class variables. We suggest a function
that defines your sensor model.</p>
</section>
<section id="cpp-file">
<h3>.cpp file<a class="headerlink" href="#cpp-file" title="Link to this heading"></a></h3>
<p>Now that you are working in the .cpp file, make sure to include the matching header file along with
<code class="docutils literal notranslate"><span class="pre">holodeck.h</span></code> and any other libraries you need. Next we will define our necessary functions.</p>
<p>Start with the constructor. It should look something like the following:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">UExampleSensor</span><span class="o">::</span><span class="n">UExampleSensor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PrimaryComponentTick</span><span class="p">.</span><span class="n">bCanEverTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">SensorName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ExampleSensor&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Initialize the sensor with any variables that it needs to function. For example, make sure to attach
the sensor to its parent:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">UExampleSensor::InitializeSensor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">InitializeSensor</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//You need to get the pointer to the object the sensor is attached to.</span>
<span class="w">    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetAttachmentRootActor</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, set up the <code class="docutils literal notranslate"><span class="pre">.tick()</span></code> function. This returns your sensor’s output, which is sent to the client
through the shared buffer. This is where you would call your sensor model that implements the sensor.
For our example, we will have our sensor return the float <code class="docutils literal notranslate"><span class="pre">2.0</span></code> at each tick:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">UExampleSensor::TickSensorComponent</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">,</span><span class="w"> </span><span class="n">ELevelTick</span><span class="w"> </span><span class="n">TickType</span><span class="p">,</span><span class="w"> </span><span class="n">FActorComponentTickFunction</span><span class="o">*</span><span class="w"> </span><span class="n">ThisTickFunction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">FloatBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">Buffer</span><span class="p">);</span>
<span class="w">    </span><span class="n">FloatBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These are all of the necessary functions. Fill in your other functions from the .h file as needed.</p>
</section>
</section>
<section id="python">
<h2>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">client/src/biguasim/sensors.py</span></code>, add a class for your new sensor. Set the sensor type as
follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ExampleSensor</span><span class="p">(</span><span class="n">HolodeckSensor</span><span class="p">):</span>
    <span class="n">sensor_type</span> <span class="o">=</span> <span class="s2">&quot;ExampleSensor&quot;</span>
</pre></div>
</div>
<p>Everything not specific to your sensor can be initialized by the super class. If you have sensor-
specific items that need to be initialized, do something like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;OpticalModemSensor&quot;</span><span class="p">,</span>  <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExampleSensor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the above is not always necessary, but can be useful in some cases.</p>
<p>The only other requirements for your sensor class are the data type (dtype) and data shape
(data_shape). These let the client know how what kind of data it should be expecting to receive from
the buffer.</p>
<p>Recall that in our example .cpp file we set the tick function to return the float <code class="docutils literal notranslate"><span class="pre">2.0</span></code>. We also
only returned a single float. With that in mind, we know that the dtype should be a float and the
data_shape should be 1. It should look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="c1"># Note that we are using numpy&#39;s data types to get the right size for the Python data.</span>

<span class="nd">@property</span>
<span class="k">def</span><span class="w"> </span><span class="nf">data_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The data_shape can store a multi-dimensional array if necessary, so for a 2x2 array return [2, 2].</p>
</div>
</section>
<section id="allowing-your-sensor-to-be-used-in-biguasim">
<h2>Allowing Your Sensor to Be Used In BiguaSim<a class="headerlink" href="#allowing-your-sensor-to-be-used-in-biguasim" title="Link to this heading"></a></h2>
<p>At this point the main structure of the sensor is implemented. The following steps make your sensor
available to the BiguaSim client.</p>
<p>First, towards the bottom of the <code class="docutils literal notranslate"><span class="pre">sensors.py</span></code> file there should be a _sensor_keys_ dictionary in the
<code class="docutils literal notranslate"><span class="pre">SensorDefinition</span></code> class. Add a line to the dictionary for your sensor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ExampleSensor&quot;</span><span class="p">:</span><span class="n">ExampleSensor</span><span class="p">,</span>
</pre></div>
</div>
<p>Additionally, if your sensor is computationally expensive and you expect the <code class="docutils literal notranslate"><span class="pre">Hz</span></code> parameter to be set, and affect
the run speed, you will need to add it to the list of _heavy_sensors or _sonar_sensors in the <code class="docutils literal notranslate"><span class="pre">SensorDefinition</span></code> class.</p>
<p>Next, in <code class="docutils literal notranslate"><span class="pre">engine/Source/Holodeck/ClientCommands/Public/AddSensorCommand.h</span></code>, add an include statement
for your sensor’s .h file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ExampleSensor.h&quot;</span>
</pre></div>
</div>
<p>Lastly, in the corresponding <code class="docutils literal notranslate"><span class="pre">AddSensorCommand.cpp</span></code>, add an entry for your sensor in the SensorMap
dictionary:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="s">&quot;ExampleSensor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UExampleSensor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
</pre></div>
</div>
<p>Your sensor should now be available to use BiguaSim!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="agents.html" class="btn btn-neutral float-left" title="Developing Agents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright FURG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>